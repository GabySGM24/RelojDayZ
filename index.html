<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hora DayZ</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #121212;
      color: #fff;
      margin: 0;
    }
    #timeBox {
      background: #1f1f1f;
      padding: 20px 40px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    #detectedTime {
      font-size: 3rem;
      font-weight: bold;
      display: block;
      margin-bottom: 10px;
    }
    #dayNightIndicator {
      font-size: 1.5rem;
      padding: 8px 16px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    #dayNightIndicator.dia {
      background-color: #28a745;
      color: #fff;
    }
    #dayNightIndicator.noche {
      background-color: #343a40;
      color: #fff;
    }
    button {
      padding: 8px 16px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div id="timeBox">
    <span id="detectedTime">--:--</span>
    <div id="dayNightIndicator"></div>
    <button onclick="load()">Actualizar</button>
  </div>

<script>
const serverId = "30957355"; // ID fijo del servidor
async function fetchServer(id) {
  const url = `https://api.battlemetrics.com/servers/${encodeURIComponent(id)}`;
  const r = await fetch(url, { headers: { 'Accept': 'application/vnd.api+json' } });
  if (!r.ok) throw new Error(`HTTP ${r.status}`);
  return r.json();
}

function* walk(obj, path = []) {
  if (obj && typeof obj === 'object') {
    for (const k of Object.keys(obj)) {
      const v = obj[k];
      const newPath = path.concat(k);
      yield { key: k, value: v, path: newPath };
      if (v && typeof v === 'object') yield* walk(v, newPath);
    }
  }
}

function formatPath(pathArr) { return pathArr.join('.'); }

async function load() {
  try {
    const json = await fetchServer(serverId);
    const attrs = json?.data?.attributes ?? {};
    let hora = null;
    for (const entry of walk(attrs)) {
      if (/time/i.test(entry.key) || /time/i.test(formatPath(entry.path))) {
        if (typeof entry.value === 'string' && /^\d{2}:\d{2}$/.test(entry.value)) {
          hora = entry.value;
          break;
        }
      }
    }

    if (hora) {
      document.getElementById('detectedTime').textContent = hora;
      const [h, m] = hora.split(':').map(Number);
      const totalMin = h * 60 + m;
      const amanecer = 5 * 60;   // 05:00
      const anochecer = 21 * 60; // 21:00
      const isDay = totalMin >= amanecer && totalMin < anochecer;
      const indicator = document.getElementById('dayNightIndicator');
      indicator.textContent = isDay ? 'Es de DÍA' : 'Es de NOCHE';
      indicator.className = isDay ? 'dia' : 'noche';
    }
  } catch (err) {
    document.getElementById('detectedTime').textContent = "Error";
    document.getElementById('dayNightIndicator').textContent = err.message;
    document.getElementById('dayNightIndicator').className = '';
  }
}

load();
setInterval(load, 60000); // Auto-actualiza cada minuto
</script>
</body>
</html>
